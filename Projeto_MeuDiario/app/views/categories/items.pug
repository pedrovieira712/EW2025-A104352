extends ../layout

block content
  if category
    .d-flex.justify-content-between.align-items-center.mb-4
      div
        h1 
          i.bi.bi-folder.me-2
          = category.name
        if category.description
          p.text-muted= category.description
      a.btn.btn-outline-primary(href='/categories') Todas as Categorias

    if items && items.length > 0
      .row
        each item in items
          .col-md-6.col-lg-4.mb-3
            .card.h-100
              .card-header.d-flex.justify-content-between.align-items-center
                h6.mb-0= item.title
                span.badge(class=item.type === 'zip' ? 'bg-info' : 'bg-secondary')= item.type
              
              .card-body
                if item.description
                  p.card-text= item.description.length > 100 ? item.description.substring(0, 100) + '...' : item.description
                else
                  p.text-muted.card-text Sem descrição
                
                if item.tags && item.tags.length > 0
                  .mb-2
                    each tag in item.tags.slice(0, 3)
                      span.badge.bg-light.text-dark.me-1= tag
                    if item.tags.length > 3
                      span.text-muted +#{item.tags.length - 3} mais
                
                .d-flex.justify-content-between.align-items-center.mt-auto
                  small.text-muted= new Date(item.createdAt).toLocaleDateString('pt-PT')
                  a.btn.btn-primary.btn-sm(href=`/items/${item._id}`) Ver
    else
      .alert.alert-info.text-center
        h4 Nenhum item nesta categoria
        p Esta categoria ainda não tem conteúdos associados.
        if user
          a.btn.btn-primary(href='/items/new') Criar Primeiro Item

    if category.parent
      .mt-4
        .alert.alert-light
          i.bi.bi-info-circle.me-2
          | Esta é uma subcategoria de 
          a(href=`/categories/${category.parent._id}`)= category.parent.name

  else
    .alert.alert-danger Categoria não encontrada