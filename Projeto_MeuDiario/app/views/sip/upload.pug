extends ../layout

block content
  .row.justify-content-center
    .col-md-8
      .card
        .card-header
          h3 
            i.bi.bi-upload.me-2
            | Upload de Pacote SIP
        .card-body
          .alert.alert-info
            h5 
              i.bi.bi-info-circle.me-2
              | Instruções:
            ul
              li O ficheiro deve ser um ZIP (máximo 50MB)
              li Deve conter um <strong>manifesto-SIP.json</strong> na raiz
              li Todos os ficheiros referenciados no manifesto devem estar incluídos
              li O manifesto deve ter pelo menos os campos: <code>title</code> e <code>producer</code>
          
          if error
            .alert.alert-danger
              h5 
                i.bi.bi-exclamation-triangle.me-2
                | Erro no Upload
              p= error
          
          form#sipForm(method='POST', action='/sip/upload', enctype='multipart/form-data')
            .mb-3
              label.form-label(for='zipFile') Selecionar Ficheiro ZIP
              input.form-control(type='file', id='zipFile', name='zipFile', accept='.zip', required)
              .form-text Tamanho máximo: 50MB
            
            .d-grid
              button.btn.btn-success(type='submit', id='submitBtn') 
                i.bi.bi-upload.me-1
                | Processar SIP
          
          // Área de progresso
          .mt-3#progressArea(style='display: none;')
            .alert.alert-info
              .d-flex.align-items-center
                .spinner-border.spinner-border-sm.me-2(role='status')
                span Processando SIP... Por favor aguarde.
          
          hr
          
          .row
            .col-md-6
              h5 Exemplo de Manifesto (manifesto-SIP.json):
              pre.bg-light.p-3
                code.
                  {
                    "title": "Viagem a Paris 2025",
                    "description": "Fotos e documentos da viagem",
                    "type": "mixed",
                    "producer": "João Silva",
                    "createdAt": "2025-01-15",
                    "isPublic": true,
                    "files": [
                      {
                        "filename": "foto1.jpg",
                        "description": "Torre Eiffel"
                      },
                      {
                        "filename": "bilhete.pdf",
                        "description": "Bilhete de avião"
                      }
                    ],
                    "metadata": {
                      "location": "Paris, França",
                      "event": "Férias"
                    }
                  }
            
            .col-md-6
              h5 Estrutura do ZIP:
              pre.bg-light.p-3
                code.
                  meu-sip.zip
                  ├── manifesto-SIP.json
                  ├── foto1.jpg
                  └── bilhete.pdf
              
              .alert.alert-warning.mt-3
                h6 
                  i.bi.bi-exclamation-triangle.me-2
                  | Campos Obrigatórios:
                ul.mb-0
                  li <strong>title</strong>: Título do item
                  li <strong>producer</strong>: Quem criou o conteúdo

  script.
    document.getElementById('sipForm').addEventListener('submit', function(e) {
      const fileInput = document.getElementById('zipFile');
      const submitBtn = document.getElementById('submitBtn');
      const progressArea = document.getElementById('progressArea');
      
      if (!fileInput.files[0]) {
        e.preventDefault();
        alert('Por favor selecione um ficheiro ZIP');
        return;
      }
      
      const file = fileInput.files[0];
      
      // Verificar se é ZIP
      if (!file.name.toLowerCase().endsWith('.zip')) {
        e.preventDefault();
        alert('Por favor selecione apenas ficheiros ZIP');
        return;
      }
      
      // Verificar tamanho (50MB)
      if (file.size > 50 * 1024 * 1024) {
        e.preventDefault();
        alert('Ficheiro muito grande. Máximo permitido: 50MB');
        return;
      }
      
      // Mostrar progresso
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i> Processando...';
      progressArea.style.display = 'block';
    });
